<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Restaurant POS</title>
  <style>
    body { margin: 0; font-family: sans-serif; background: #f2f2f2; }
    .header { background: #fff; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .content { display: flex; height: calc(100vh - 60px); }
    .categories, .items, .cart { padding: 15px; overflow-y: auto; }
    .categories { width: 20%; background: #fff; border-right: 1px solid #ccc; }
    .items { width: 50%; background: #fff; border-right: 1px solid #ccc; }
    .cart { width: 30%; background: #fff; }
    .category-btn, .item-btn { display: block; width: 100%; padding: 10px; margin-bottom: 8px; border: none; cursor: pointer; font-size: 16px; }
    .category-btn { background: #e0e0e0; }
    .item-btn { background: #d9edf7; }
    .cart-item { display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px; background: #f9f9f9; border: 1px solid #ddd; }
    .cart-total { font-weight: bold; font-size: 18px; padding-top: 10px; }
    .cart-item div button { margin-left: 5px; }
    .cart input, .cart select { margin: 5px 0; width: 100%; padding: 5px; }
  </style>
</head>
<body>
  <div class="header">
    <h2>Restaurant POS</h2>
    <span id="user-info"></span>
  </div>

  <div class="content">
    <div class="categories" id="categories"></div>
    <div class="items" id="items"></div>
    <div class="cart">
      <h3>Cart</h3>
      <div id="cart-items"></div>
      <div class="cart-total">
        <div>Total: Rp<span id="cart-subtotal">0</span></div>
        <div>Tax (%): <input type="number" id="tax" value="10" onchange="updateCartDisplay()"></div>
        <div>Discount (%): <input type="number" id="discount" value="0" onchange="updateCartDisplay()"></div>
        <div>Order Type: 
          <select id="order-type">
            <option value="Dine-In">Dine-In</option>
            <option value="Parcel">Parcel</option>
          </select>
        </div>
        <div>Payment Method: 
          <select id="payment-method">
            <option value="Cash">Cash</option>
            <option value="QR">QR</option>
            <option value="Card">Card</option>
          </select>
        </div>
        <div><strong>Final Total: Rp<span id="cart-total">0</span></strong></div>
      </div>
      <button onclick="printReceipt()">üñ®Ô∏è Print Receipt</button>
      <button onclick="saveOrder()">üíæ Save Order</button>
      <div id="receipt" style="display:none; font-family: monospace;">
        <h3>Restaurant Receipt</h3>
        <div id="receipt-items"></div>
        <div id="receipt-total"></div>
        <p style="font-size: 12px;">Thank you for your order!</p>
      </div>
    </div>
  </div>

  <script>
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    if (!currentUser) window.location.href = "index.html";
    document.getElementById("user-info").textContent = `User: ${currentUser.username} (${currentUser.role})`;

    const categories = ["Makanan", "Minuman"];
    const items = [
      { name: "Nasi Goreng", price: 20000, category: "Makanan" },
      { name: "Ayam Bakar", price: 25000, category: "Makanan" },
      { name: "Es Teh", price: 5000, category: "Minuman" },
      { name: "Jus Alpukat", price: 10000, category: "Minuman" }
    ];

    const cart = [];

    function renderCategories() {
      const catDiv = document.getElementById('categories');
      catDiv.innerHTML = '';
      categories.forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'category-btn';
        btn.textContent = cat;
        btn.onclick = () => renderItems(cat);
        catDiv.appendChild(btn);
      });
    }

    function renderItems(category) {
      const itemsDiv = document.getElementById('items');
      itemsDiv.innerHTML = '';
      items.filter(i => i.category === category).forEach(item => {
        const btn = document.createElement('button');
        btn.className = 'item-btn';
        btn.textContent = `${item.name} - Rp${item.price}`;
        btn.onclick = () => addToCart(item);
        itemsDiv.appendChild(btn);
      });
    }

    function addToCart(item) {
      const existing = cart.find(c => c.name === item.name);
      if (existing) existing.qty++;
      else cart.push({ ...item, qty: 1 });
      updateCartDisplay();
    }

    function changeQty(index, delta) {
      cart[index].qty += delta;
      if (cart[index].qty <= 0) cart.splice(index, 1);
      updateCartDisplay();
    }

    function removeItem(index) {
      cart.splice(index, 1);
      updateCartDisplay();
    }

    function updateCartDisplay() {
      const cartDiv = document.getElementById('cart-items');
      cartDiv.innerHTML = '';
      let subtotal = 0;
      cart.forEach((item, index) => {
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `
          <span>${item.qty} x ${item.name} = Rp${item.qty * item.price}</span>
          <div>
            <button onclick="changeQty(${index}, -1)">‚ûñ</button>
            <button onclick="changeQty(${index}, 1)">‚ûï</button>
            <button onclick="removeItem(${index})">üóëÔ∏è</button>
          </div>`;
        cartDiv.appendChild(div);
        subtotal += item.qty * item.price;
      });
      document.getElementById('cart-subtotal').textContent = subtotal;

      const tax = parseFloat(document.getElementById('tax').value) || 0;
      const discount = parseFloat(document.getElementById('discount').value) || 0;

      let totalWithTax = subtotal + (subtotal * tax / 100);
      let totalAfterDiscount = totalWithTax - (totalWithTax * discount / 100);

      document.getElementById('cart-total').textContent = totalAfterDiscount.toFixed(0);
    }

    function printReceipt() {
      if (cart.length === 0) return alert("Cart is empty!");

      const receiptItems = document.getElementById('receipt-items');
      const receiptTotal = document.getElementById('receipt-total');
      receiptItems.innerHTML = '';

      let subtotal = 0;
      cart.forEach(item => {
        const line = document.createElement('div');
        line.textContent = `${item.qty} x ${item.name} = Rp${item.qty * item.price}`;
        receiptItems.appendChild(line);
        subtotal += item.qty * item.price;
      });

      const tax = parseFloat(document.getElementById('tax').value) || 0;
      const discount = parseFloat(document.getElementById('discount').value) || 0;
      const totalWithTax = subtotal + (subtotal * tax / 100);
      const totalAfterDiscount = totalWithTax - (totalWithTax * discount / 100);
      const orderType = document.getElementById('order-type').value;
      const paymentMethod = document.getElementById('payment-method').value;

      receiptTotal.innerHTML = `
        <hr>
        Subtotal: Rp${subtotal}<br>
        Tax (${tax}%): Rp${(subtotal * tax / 100).toFixed(0)}<br>
        Discount (${discount}%): Rp${(totalWithTax * discount / 100).toFixed(0)}<br>
        Order Type: ${orderType}<br>
        Payment Method: ${paymentMethod}<br>
        <strong>Total: Rp${totalAfterDiscount.toFixed(0)}</strong>
      `;

      const printWindow = window.open('', '', 'width=400,height=600');
      printWindow.document.write('<html><head><title>Receipt</title></head><body>');
      printWindow.document.write(document.getElementById('receipt').innerHTML);
      printWindow.document.write('</body></html>');
      printWindow.document.close();
      printWindow.print();
    }

    function saveOrder() {
      const date = new Date().toLocaleString();
      const orderType = document.getElementById('order-type').value;
      const paymentMethod = document.getElementById('payment-method').value;
      const tax = parseFloat(document.getElementById('tax').value) || 0;
      const discount = parseFloat(document.getElementById('discount').value) || 0;
      const subtotal = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
      const totalWithTax = subtotal + (subtotal * tax / 100);
      const finalTotal = totalWithTax - (totalWithTax * discount / 100);

      const order = {
        date,
        user: currentUser.username,
        cart: [...cart],
        subtotal,
        tax,
        discount,
        finalTotal,
        orderType,
        paymentMethod
      };

      const savedOrders = JSON.parse(localStorage.getItem('orders') || '[]');
      savedOrders.push(order);
      localStorage.setItem('orders', JSON.stringify(savedOrders));

      alert('Order saved successfully.');
      cart.length = 0;
      updateCartDisplay();
    }

    renderCategories();
    updateCartDisplay();
  </script>
</body>
</html>
