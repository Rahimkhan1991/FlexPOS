<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Restaurant POS</title>
  <style>
    body { margin: 0; font-family: sans-serif; background: #f2f2f2; }
    .header { background: #fff; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .content { display: flex; height: calc(100vh - 60px); }
    .categories, .items, .cart { padding: 15px; overflow-y: auto; }
    .categories { width: 20%; background: #fff; border-right: 1px solid #ccc; }
    .items { width: 50%; background: #fff; border-right: 1px solid #ccc; }
    .cart { width: 30%; background: #fff; }
    .category-btn, .item-btn { display: block; width: 100%; padding: 10px; margin-bottom: 8px; border: none; cursor: pointer; font-size: 16px; }
    .category-btn { background: #e0e0e0; }
    .item-btn { background: #d9edf7; }
    .cart-item { display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px; background: #f9f9f9; border: 1px solid #ddd; }
    .cart-total { font-weight: bold; font-size: 18px; padding-top: 10px; }
    .cart-item div button {
  margin-left: 5px;
}

  </style>
</head>
<body>
  <div class="header">
    <h2>Restaurant POS</h2>
    <span id="user-info"></span>
  </div>

  <div class="content">
    <div class="categories" id="categories"></div>
    <div class="items" id="items"></div>
    <div class="cart">
      <h3>Cart</h3>
      <div id="cart-items"></div>
      <div class="cart-total">
  <div>Total: Rp<span id="cart-subtotal">0</span></div>
  <div>
    Tax (%): <input type="number" id="tax" value="10" style="width: 50px;" onchange="updateCartDisplay()">
  </div>
  <div>
    Discount (%): <input type="number" id="discount" value="0" style="width: 50px;" onchange="updateCartDisplay()">
  </div>
  <div><strong>Final Total: Rp<span id="cart-total">0</span></strong></div>
</div>
<button onclick="printReceipt()" style="margin-top: 10px;">üñ®Ô∏è Print Receipt</button>

      
      <button onclick="printReceipt()" style="margin-top: 10px;">üñ®Ô∏è Print Receipt</button>
      <div id="receipt" style="display:none; font-family: monospace;">
  <h3>Restaurant Receipt</h3>
  <div id="receipt-items"></div>
  <div id="receipt-total"></div>
  <p style="font-size: 12px;">Thank you for your order!</p>
</div>


    </div>
  </div>

  <script>
    // Check login
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    if (!currentUser) {
      window.location.href = "index.html";
    }
    document.getElementById("user-info").textContent = `User: ${currentUser.username} (${currentUser.role})`;

    // Sample Data (Later replace with data.js or backend)
    const categories = ["Makanan", "Minuman"];
    const items = [
      { name: "Nasi Goreng", price: 20000, category: "Makanan" },
      { name: "Ayam Bakar", price: 25000, category: "Makanan" },
      { name: "Es Teh", price: 5000, category: "Minuman" },
      { name: "Jus Alpukat", price: 10000, category: "Minuman" }
    ];

    const cart = [];

    function renderCategories() {
      const catDiv = document.getElementById('categories');
      catDiv.innerHTML = '';
      categories.forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'category-btn';
        btn.textContent = cat;
        btn.onclick = () => renderItems(cat);
        catDiv.appendChild(btn);
      });
    }

    function renderItems(category) {
      const itemsDiv = document.getElementById('items');
      itemsDiv.innerHTML = '';
      items.filter(i => i.category === category).forEach(item => {
        const btn = document.createElement('button');
        btn.className = 'item-btn';
        btn.textContent = `${item.name} - Rp${item.price}`;
        btn.onclick = () => addToCart(item);
        itemsDiv.appendChild(btn);
      });
    }

    function addToCart(item) {
      const existing = cart.find(c => c.name === item.name);
      if (existing) {
        existing.qty++;
      } else {
        cart.push({ ...item, qty: 1 });
      }
      updateCart();
    }

 
function changeQty(index, delta) {function updateCartDisplay() {
  const cartDiv = document.getElementById('cart-items');
  cartDiv.innerHTML = '';
  let subtotal = 0;

  cart.forEach(c => {
    const div = document.createElement('div');
    div.className = 'cart-item';
    div.textContent = `${c.qty} x ${c.name} = Rp${c.qty * c.price}`;
    cartDiv.appendChild(div);
    subtotal += c.qty * c.price;
  });

  document.getElementById('cart-subtotal').textContent = subtotal;

  const tax = parseFloat(document.getElementById('tax').value) || 0;
  const discount = parseFloat(document.getElementById('discount').value) || 0;

  let totalWithTax = subtotal + (subtotal * tax / 100);
  let totalAfterDiscount = totalWithTax - (totalWithTax * discount / 100);

  document.getElementById('cart-total').textContent = totalAfterDiscount.toFixed(0);
}

  cart[index].qty += delta;
  if (cart[index].qty <= 0) {
    cart.splice(index, 1);
  }
  updateCart();
}

function removeItem(index) {
  cart.splice(index, 1);
  updateCart();
}


    renderCategories();
    
function printReceipt() {
  if (cart.length === 0) {
    alert("Cart is empty!");
    return;
  }

  const receiptItems = document.getElementById('receipt-items');
  const receiptTotal = document.getElementById('receipt-total');
  receiptItems.innerHTML = '';

  let subtotal = 0;
  cart.forEach(item => {
    const line = document.createElement('div');
    line.textContent = `${item.qty} x ${item.name} = Rp${item.qty * item.price}`;
    receiptItems.appendChild(line);
    subtotal += item.qty * item.price;
  });

  const tax = parseFloat(document.getElementById('tax').value) || 0;
  const discount = parseFloat(document.getElementById('discount').value) || 0;
  const totalWithTax = subtotal + (subtotal * tax / 100);
  const totalAfterDiscount = totalWithTax - (totalWithTax * discount / 100);

  const summary = `
    <hr>
    Subtotal: Rp${subtotal}<br>
    Tax (${tax}%): Rp${(subtotal * tax / 100).toFixed(0)}<br>
    Discount (${discount}%): Rp${(totalWithTax * discount / 100).toFixed(0)}<br>
    <strong>Total: Rp${totalAfterDiscount.toFixed(0)}</strong>
  `;

  receiptTotal.innerHTML = summary;

  const printWindow = window.open('', '', 'width=400,height=600');
  printWindow.document.write('<html><head><title>Receipt</title></head><body>');
  printWindow.document.write(document.getElementById('receipt').innerHTML);
  printWindow.document.write('</body></html>');
  printWindow.document.close();
  printWindow.print();
}

  </script>
</body>
</html>
