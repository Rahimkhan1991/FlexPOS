<!DOCTYPE html>
<html lang="en" class="">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>System Settings</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <script>
        tailwind.config = { darkMode: 'class' };
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>
    <style>
        html { scroll-behavior: smooth; }
    </style>
</head>

<body class="bg-slate-50 text-slate-800 dark:bg-slate-900 dark:text-slate-200 transition-colors duration-300">
    <div id="toast" class="fixed top-5 right-5 bg-green-500 text-white py-2 px-6 rounded-lg shadow-xl translate-x-[150%] transform transition-transform duration-500 ease-in-out">
        Settings saved successfully!
    </div>

    <div class="flex min-h-screen">
        <main class="flex-1 p-6 md:p-10">
            <form id="settingsForm">
                <div class="max-w-4xl mx-auto">
                    <div class="flex justify-between items-center mb-10">
                        <div>
                            <h2 class="text-3xl font-bold">System Settings</h2>
                            <p class="text-slate-500 dark:text-slate-400 mt-1">Manage your company and application settings.</p>
                        </div>
                        <div class="flex gap-3">
                            <button type="button" id="backBtn" class="bg-white dark:bg-slate-700 dark:hover:bg-slate-600 dark:text-slate-200 dark:border-slate-600 hover:bg-slate-100 text-slate-700 px-5 py-2.5 rounded-lg font-semibold shadow-sm border border-slate-200 transition">Back</button>
                            <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-2.5 rounded-lg font-semibold shadow-md transition">Save Settings</button>
                        </div>
                    </div>

                    <section id="general" class="bg-white dark:bg-slate-800 p-8 rounded-2xl shadow-md border border-slate-100 dark:border-slate-700 mb-8">
                        <h3 class="text-xl font-semibold mb-6 border-b pb-4 border-slate-200 dark:border-slate-700">üè¢ General</h3>
                        <div class="grid md:grid-cols-2 gap-x-8 gap-y-6">
                            <div class="md:col-span-2">
                                <label for="companyName" class="block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1">Company Name</label>
                                <input type="text" id="companyName" class="w-full p-3 bg-transparent rounded-lg border border-slate-300 dark:border-slate-600 focus:ring-2 focus:ring-indigo-400 focus:outline-none" required>
                            </div>
                            <div>
                                <label for="email" class="block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1">Email Address</label>
                                <input type="email" id="email" class="w-full p-3 bg-transparent rounded-lg border border-slate-300 dark:border-slate-600 focus:ring-2 focus:ring-indigo-400 focus:outline-none" required>
                            </div>
                            <div>
                                <label for="phoneNumber" class="block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1">Phone Number</label>
                                <input type="tel" id="phoneNumber" class="w-full p-3 bg-transparent rounded-lg border border-slate-300 dark:border-slate-600 focus:ring-2 focus:ring-indigo-400 focus:outline-none" required>
                            </div>
                            <div class="md:col-span-2">
                                <label for="currency" class="block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1">Currency</label>
                                <select id="currency" class="w-full p-3 bg-transparent rounded-lg border border-slate-300 dark:border-slate-600 focus:ring-2 focus:ring-indigo-400 focus:outline-none"></select>
                            </div>
                            <div class="md:col-span-2">
                                <label for="address" class="block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1">Address</label>
                                <textarea id="address" rows="3" class="w-full p-3 bg-transparent rounded-lg border border-slate-300 dark:border-slate-600 focus:ring-2 focus:ring-indigo-400 focus:outline-none" placeholder="Street, City, ZIP"></textarea>
                            </div>

                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1">Company Logo</label>
                                <div class="mt-2 flex items-center gap-6">
                                    <div id="logoPreview" class="w-20 h-20 bg-slate-100 dark:bg-slate-700 rounded-full flex items-center justify-center border-2 border-dashed border-slate-300 dark:border-slate-600 shrink-0">
                                        <ion-icon name="image-outline" class="text-3xl text-slate-400"></ion-icon>
                                    </div>
                                    <div class="flex-1">
                                        <input type="file" id="logo" accept="image/*" class="block w-full text-sm text-slate-500
                                          file:mr-4 file:py-2 file:px-4
                                          file:rounded-full file:border-0
                                          file:text-sm file:font-semibold
                                          file:bg-indigo-50 file:text-indigo-700
                                          dark:file:bg-indigo-900/50 dark:file:text-indigo-300
                                          hover:file:bg-indigo-100 dark:hover:file:bg-indigo-900
                                        "/>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="md:col-span-2 pt-6 mt-6 border-t border-slate-200 dark:border-slate-700">
                               <label for="themeToggle" class="flex items-center justify-between cursor-pointer">
                                    <div>
                                        <h4 class="font-medium">Appearance</h4>
                                        <p class="text-sm text-slate-500 dark:text-slate-400">Switch between light and dark mode.</p>
                                    </div>
                                    <div class="relative">
                                        <input type="checkbox" id="themeToggle" class="sr-only peer">
                                        <div class="w-12 h-6 bg-slate-300 dark:bg-slate-600 rounded-full peer peer-checked:bg-indigo-600 transition duration-300"></div>
                                        <div class="absolute left-0 top-0 w-6 h-6 bg-white rounded-full shadow-md transform transition-transform duration-300 peer-checked:translate-x-full"></div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </section>
                    
                    <section id="financial" class="bg-white dark:bg-slate-800 p-8 rounded-2xl shadow-md border border-slate-100 dark:border-slate-700 mb-8">
                         <h3 class="text-xl font-semibold mb-6 border-b pb-4 border-slate-200 dark:border-slate-700">üí∞ Financial</h3>
                         <div class="grid md:grid-cols-2 gap-8">
                             <div>
                                <label for="tax" class="block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1">Tax Percentage (%)</label>
                                <input type="number" id="tax" class="w-full p-3 bg-transparent rounded-lg border border-slate-300 dark:border-slate-600 focus:ring-2 focus:ring-indigo-400 focus:outline-none" min="0" step="0.01" placeholder="e.g., 10" required>
                            </div>
                            <div>
                                <label for="discount" class="block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1">Default Discount (%)</label>
                                <input type="number" id="discount" class="w-full p-3 bg-transparent rounded-lg border border-slate-300 dark:border-slate-600 focus:ring-2 focus:ring-indigo-400 focus:outline-none" min="0" step="0.01" placeholder="e.g., 5">
                            </div>
                         </div>
                    </section>

                    <section id="invoicing" class="bg-white dark:bg-slate-800 p-8 rounded-2xl shadow-md border border-slate-100 dark:border-slate-700 mb-8">
                         <h3 class="text-xl font-semibold mb-6 border-b pb-4 border-slate-200 dark:border-slate-700">üìÑ Invoicing</h3>
                         <div class="grid md:grid-cols-3 gap-6">
                            <div>
                                <label for="invoicePrefix" class="block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1">Invoice Prefix</label>
                                <input type="text" id="invoicePrefix" placeholder="INV-" class="w-full p-3 bg-transparent rounded-lg border border-slate-300 dark:border-slate-600 focus:ring-2 focus:ring-indigo-400 focus:outline-none">
                            </div>
                            <div>
                                <label for="invoiceStartNumber" class="block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1">Start Number</label>
                                <input type="number" min="1" id="invoiceStartNumber" placeholder="1001" class="w-full p-3 bg-transparent rounded-lg border border-slate-300 dark:border-slate-600 focus:ring-2 focus:ring-indigo-400 focus:outline-none">
                            </div>
                            <div>
                                <label for="invoiceDueDays" class="block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1">Due After (Days)</label>
                                <input type="number" min="0" id="invoiceDueDays" placeholder="14" class="w-full p-3 bg-transparent rounded-lg border border-slate-300 dark:border-slate-600 focus:ring-2 focus:ring-indigo-400 focus:outline-none">
                            </div>
                         </div>
                         <div class="mt-6">
                             <label for="footerText" class="block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1">Footer / Terms & Conditions</label>
                             <textarea id="footerText" rows="4" class="w-full p-3 bg-transparent rounded-lg border border-slate-300 dark:border-slate-600 focus:ring-2 focus:ring-indigo-400 focus:outline-none"></textarea>
                         </div>
                    </section>
                    
                    <section id="pos" class="bg-white dark:bg-slate-800 p-8 rounded-2xl shadow-md border border-slate-100 dark:border-slate-700">
                        <h3 class="text-xl font-semibold mb-6 border-b pb-4 border-slate-200 dark:border-slate-700">üõí Point of Sale (POS)</h3>
                        <div class="space-y-5">
                            <label for="togglePaymentPopup" class="flex items-center justify-between cursor-pointer">
                                <div>
                                    <h4 class="font-medium">Enable Payment Popup</h4>
                                    <p class="text-sm text-slate-500 dark:text-slate-400">Show a confirmation popup during checkout.</p>
                                </div>
                                <div class="relative">
                                    <input type="checkbox" id="togglePaymentPopup" class="sr-only peer">
                                    <div class="w-12 h-6 bg-slate-300 dark:bg-slate-600 rounded-full peer peer-checked:bg-indigo-600 transition duration-300"></div>
                                    <div class="absolute left-0 top-0 w-6 h-6 bg-white rounded-full shadow-md transform transition-transform duration-300 peer-checked:translate-x-full"></div>
                                </div>
                            </label>
                            <hr class="dark:border-slate-700">
                            <label for="toggleChangeCalc" class="flex items-center justify-between cursor-pointer">
                                <div>
                                    <h4 class="font-medium">Enable Change Calculation</h4>
                                    <p class="text-sm text-slate-500 dark:text-slate-400">Automatically calculate change after payment.</p>
                                </div>
                                <div class="relative">
                                    <input type="checkbox" id="toggleChangeCalc" class="sr-only peer">
                                    <div class="w-12 h-6 bg-slate-300 dark:bg-slate-600 rounded-full peer peer-checked:bg-indigo-600 transition duration-300"></div>
                                    <div class="absolute left-0 top-0 w-6 h-6 bg-white rounded-full shadow-md transform transition-transform duration-300 peer-checked:translate-x-full"></div>
                                </div>
                            </label>
                        </div>
                    </section>
                </div>
            </form>
        </main>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- ELEMENT REFERENCES ---
        const currencyDropdown = document.getElementById('currency');
        const logoInput = document.getElementById('logo');
        const logoPreview = document.getElementById('logoPreview');
        const themeToggle = document.getElementById('themeToggle');

        // --- DATA ---
        const currencies = [
            { code: "USD", symbol: "$", name: "US Dollar" }, { code: "EUR", symbol: "‚Ç¨", name: "Euro" }, { code: "JPY", symbol: "¬•", name: "Japanese Yen" }, { code: "GBP", symbol: "¬£", name: "British Pound" }, { code: "AUD", symbol: "A$", name: "Australian Dollar" }, { code: "CAD", symbol: "C$", name: "Canadian Dollar" }, { code: "CHF", symbol: "CHF", name: "Swiss Franc" }, { code: "CNY", symbol: "¬•", name: "Chinese Yuan" }, { code: "IDR", symbol: "Rp", name: "Indonesian Rupiah" }, { code: "INR", symbol: "‚Çπ", name: "Indian Rupee" }, { code: "BRL", symbol: "R$", name: "Brazilian Real" }, { code: "RUB", symbol: "‚ÇΩ", name: "Russian Ruble" }, { code: "KRW", symbol: "‚Ç©", name: "South Korean Won" }, { code: "SGD", symbol: "S$", name: "Singapore Dollar" }, { code: "MYR", symbol: "RM", name: "Malaysian Ringgit" }, { code: "NZD", symbol: "NZ$", name: "New Zealand Dollar" }, { code: "PHP", symbol: "‚Ç±", name: "Philippine Peso" }, { code: "THB", symbol: "‡∏ø", name: "Thai Baht" }, { code: "VND", symbol: "‚Ç´", name: "Vietnamese Dong" }, { code: "AED", symbol: "ÿØ.ÿ•", name: "UAE Dirham" }, { code: "SAR", symbol: "Ô∑º", name: "Saudi Riyal" }
        ];

        const formFields = {
            companyName: 'text', phoneNumber: 'text', email: 'text', address: 'text',
            currency: 'text', tax: 'number', discount: 'number',
            invoicePrefix: 'text', invoiceStartNumber: 'number', invoiceDueDays: 'number',
            footerText: 'text',
            togglePaymentPopup: 'checkbox', toggleChangeCalc: 'checkbox',
            logo: 'image' // Added logo field
        };

        // --- FUNCTIONS ---
        function populateCurrencies() {
            currencies.forEach(c => {
                const option = document.createElement('option');
                option.value = c.symbol;
                option.textContent = `${c.name} (${c.code} - ${c.symbol})`;
                currencyDropdown.appendChild(option);
            });
        }
        
        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('systemSettings') || '{}');
            for (const key in formFields) {
                const el = document.getElementById(key);
                if (el && settings[key] !== undefined) {
                    if (formFields[key] === 'checkbox') {
                        el.checked = settings[key];
                    } else if (formFields[key] === 'image' && settings[key]) {
                        const img = document.createElement('img');
                        img.src = settings.logo;
                        img.className = 'w-full h-full object-cover rounded-full';
                        logoPreview.innerHTML = '';
                        logoPreview.appendChild(img);
                    } else if (formFields[key] !== 'image') {
                        el.value = settings[key];
                    }
                }
            }
        }
        
        function saveSettings(logoData) {
            let settings = {};
            for (const key in formFields) {
                if (key === 'logo') continue;
                const el = document.getElementById(key);
                if (el) {
                    settings[key] = (formFields[key] === 'checkbox') ? el.checked : el.value;
                }
            }
            settings.logo = logoData;
            localStorage.setItem('systemSettings', JSON.stringify(settings));
            showToast('Settings saved successfully!');
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.remove('translate-x-[150%]');
            setTimeout(() => {
                toast.classList.add('translate-x-[150%]');
            }, 3000);
        }

        // --- EVENT LISTENERS ---
        document.getElementById('settingsForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const existingLogo = JSON.parse(localStorage.getItem('systemSettings') || '{}').logo;
            const file = logoInput.files[0];

            if (file) {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => saveSettings(reader.result);
            } else {
                saveSettings(existingLogo || null);
            }
        });

        document.getElementById('backBtn').addEventListener('click', () => window.history.back());
        
        // **THIS IS THE KEY PART FOR THE LIVE PREVIEW**
        logoInput.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const img = document.createElement('img');
                img.src = URL.createObjectURL(file); // Create a temporary URL for the selected file
                img.className = 'w-full h-full object-cover rounded-full';
                logoPreview.innerHTML = ''; // Clear the icon
                logoPreview.appendChild(img);
            }
        });

        themeToggle.checked = document.documentElement.classList.contains('dark');
        themeToggle.addEventListener('change', () => {
            if (themeToggle.checked) {
                document.documentElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            }
        });

        // --- RUN ON PAGE LOAD ---
        populateCurrencies();
        loadSettings();
    });
    </script>
</body>
</html>